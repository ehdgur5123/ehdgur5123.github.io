---
layout: single
title: "13) Command Injection"
categories: Security
tag: [Security]
permalink : /posts/Security-13/
toc: true
classes: custom-style
author_profile: false
sidebar:
  nav: "Security"
---

<hr>

# Command Injection이란 무엇인가?

## 개요

**Command Injection**은 서버나 애플리케이션이 외부에서 입력된 데이터를 검증하지 않고 **운영 체제(OS)의 명령어**로 직접 실행하는 **취약점**을 의미합니다. 이 취약점은 공격자가 애플리케이션을 통해 시스템 명령어를 실행할 수 있게 하며, 원격 코드 실행, 데이터 유출, 시스템 제어와 같은 심각한 보안 문제로 이어질 수 있습니다.

Command Injection은 웹 애플리케이션뿐만 아니라 네트워크 장치, IoT 기기, 그리고 다양한 서비스에서 발생할 수 있습니다. 공격자가 의도적으로 악성 명령어를 삽입하여 시스템을 악의적으로 조작할 수 있는 취약점이기 때문에, 방어하지 못할 경우 큰 피해를 초래할 수 있습니다.

## Command Injection의 기본 원리

Command Injection은 주로 애플리케이션이 **사용자 입력을 OS 명령어의 일부로 사용하는 경우 발생**합니다. 예를 들어, 웹 애플리케이션이 특정 사용자 입력을 기반으로 시스템 명령어를 실행하는 경우, 공격자는 입력 필드에 악의적인 명령어를 추가하여 서버에서 임의의 명령어가 실행되도록 만들 수 있습니다.

예를 들어, 시스템 명령어로 `ping` 명령을 호출하는 웹 애플리케이션이 있다고 가정해 봅시다.

```bash
ping <사용자 입력>
```

이때, 공격자가 다음과 같은 입력을 하게 되면:

```bash
1.1.1.1; rm -rf /
```

이 명령어는 `ping 1.1.1.1`을 실행한 후에 `rm -rf /`를 실행하여 **서버의 파일 시스템을 삭제**할 수 있습니다. 이처럼 명령어가 연결되어 실행되면서 시스템 전체에 심각한 손상을 줄 수 있습니다.

## Command Injection의 유형

Command Injection은 주로 두 가지 유형으로 나뉩니다.

1. <b>Arbitrary Command Execution(임의 명령 실행)</b>: 공격자가 원하는 운영 체제 명령어를 삽입하여 실행하는 것입니다. 이는 시스템 제어 권한을 얻거나, 민감한 정보에 접근하는 데 사용될 수 있습니다.

2. <b>Blind Command Injection(블라인드 명령어 삽입)</b>: 공격자가 삽입한 명령어의 결과가 직접적으로 표시되지 않는 경우입니다. 이때 공격자는 서버의 반응을 통해 간접적으로 성공 여부를 판단하거나, 외부 서버로 데이터를 전송하는 방식으로 결과를 얻을 수 있습니다.

## Command Injection의 위험성

Command Injection은 매우 심각한 보안 취약점으로 분류되며, 발생할 수 있는 위험은 다양하고 치명적일 수 있습니다.

- <b>시스템 제어</b>: 공격자가 서버에 대한 루트 권한을 획득하면, 서버를 완전히 장악할 수 있습니다. 이를 통해 서버에 저장된 모든 데이터를 접근하거나 삭제할 수 있습니다.
- <b>데이터 유출</b>: 시스템 명령어를 통해 서버 파일을 읽거나 전송함으로써, 민감한 데이터가 유출될 수 있습니다.
- <b>서비스 중단</b>: 서버에 대한 중요한 파일을 삭제하거나 CPU, 메모리와 같은 자원을 소모하는 명령어를 실행함으로써 서비스 거부(DoS) 상태를 유발할 수 있습니다.
- <b>원격 코드 실행</b>: 공격자는 Command Injection을 통해 원격에서 악성 코드를 실행하고 시스템을 악의적으로 조작할 수 있습니다.

## Command Injection과 Code Injection의 차이

Command Injection은 운영 체제 명령어를 악용하는 반면, **Code Injection**은 애플리케이션의 코드 실행 흐름을 조작하는 취약점입니다. 예를 들어, Code Injection에서는 공격자가 **JavaScript**, **PHP** 등의 애플리케이션 코드 내에 악성 코드를 삽입하여 실행시키는 반면, Command Injection은 운영 체제의 쉘 명령어를 대상으로 합니다.

## Command Injection의 방어 방법

1. <b>사용자 입력 검증 및 제한</b>: 사용자의 입력을 절대 신뢰하지 않고, 반드시 검증해야 합니다. 예를 들어, 정규 표현식을 사용하여 입력 값을 제한하거나, 미리 정의된 값만을 허용하는 방식이 좋습니다.

2. <b>명령어 실행 기능 사용 자제</b>: 애플리케이션 내에서 OS 명령어를 직접 호출하는 방식을 지양하고, 가능한 경우 프로그래밍 언어의 라이브러리나 API를 사용하여 작업을 처리하는 것이 좋습니다. 예를 들어, 파일 처리는 운영 체제 명령어 대신 Python이나 PHP의 파일 처리 함수를 사용하는 방식으로 대체할 수 있습니다.

3. <b>입력값 이스케이프</b>: 사용자가 입력한 값이 명령어의 일부로 사용되는 경우, 반드시 특수 문자를 이스케이프 처리하여 공격자가 악의적인 명령어를 삽입하지 못하도록 해야 합니다.

4. <b>권한 관리</b>: 애플리케이션이 실행되는 사용자 계정의 권한을 최소한으로 설정하여, 만약 공격에 성공하더라도 시스템 전체를 제어하지 못하게 해야 합니다. 루트 권한으로 애플리케이션을 실행하는 것은 매우 위험합니다.

5. <b>보안 툴과 방화벽 사용</b>: Web Application Firewall(WAF)과 같은 보안 솔루션을 통해 Command Injection을 탐지하고 차단할 수 있습니다. 이러한 툴들은 알려진 공격 패턴을 감지하고 필터링하여 추가적인 보안 계층을 제공합니다.

## 결론

Command Injection은 매우 위험한 취약점으로, 서버에 대한 완전한 제어권을 공격자에게 넘길 수 있는 심각한 보안 문제입니다. 이를 방지하기 위해서는 애플리케이션 개발 단계에서부터 사용자 입력을 철저히 검증하고, 운영 체제 명령어 실행을 지양하는 등의 보안 조치를 취해야 합니다. 철저한 방어와 보안 관리가 이러한 취약점으로 인한 피해를 예방하는 열쇠입니다.