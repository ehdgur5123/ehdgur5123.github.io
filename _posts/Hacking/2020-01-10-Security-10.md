---
layout: single
title: "10) wireshark 도구"
categories: Security
tag: [Security]
permalink : /posts/Security-10/
toc: true
classes: custom-style
author_profile: false
sidebar:
  nav: "Security"
---

<hr>

# wireshark 란?

**Wireshark**는 **네트워크 패킷 분석 도구**로, <u>네트워크 상에서 전송되는 모든 데이터 패킷을 캡처하고 분석</u>할 수 있습니다. 네트워크 트래픽을 실시간으로 모니터링하고, 트래픽의 흐름, 프로토콜 정보, 데이터의 내용 등을 상세히 파악할 수 있어, 네트워크 문제 해결, 보안 분석, 프로토콜 연구 등에 널리 사용됩니다.

# Wireshark 개요

## Wireshark의 목적 및 기능

- **네트워크 트래픽 모니터링**: 네트워크 상에서 발생하는 모든 데이터 통신을 캡처하고, 트래픽 흐름과 프로토콜 동작을 확인합니다.
- **패킷 분석**: 캡처된 패킷을 디코딩하여, 각 패킷의 출발지/목적지 주소, 프로토콜 정보, 데이터 내용 등을 세밀하게 분석할 수 있습니다.
- **프로토콜 분석**: 다양한 네트워크 프로토콜(HTTP, TCP, UDP, DNS, ARP 등)에 대한 상세한 분석을 지원하여, 프로토콜의 동작 방식과 문제점을 연구할 수 있습니다.
- **네트워크 문제 해결**: 패킷 분석을 통해 네트워크 성능 문제나 통신 오류의 원인을 파악하고, 네트워크 구성 및 보안 정책을 최적화할 수 있습니다.
- **보안 점검 및 침해 분석**: 네트워크를 통해 전송된 데이터를 분석하여 침입 시도, 악성 코드 활동, 정보 유출 등을 탐지할 수 있습니다.

## Wireshark의 주요 특징

- **실시간 패킷 캡처 및 분석**: 네트워크 인터페이스에서 실시간으로 데이터 패킷을 캡처하고, 필터링 및 디코딩하여 분석합니다.
- **지원 프로토콜 다양성**: HTTP, HTTPS, TCP/IP, UDP, DNS, ARP 등 수백 개의 네트워크 프로토콜을 지원하여, 다양한 환경에서 트래픽 분석이 가능합니다.
- **그래픽 인터페이스**: 직관적인 GUI 환경을 제공하여, 패킷의 상세 정보를 쉽게 파악할 수 있으며, 패킷 흐름 다이어그램을 통해 네트워크 트래픽을 시각적으로 분석할 수 있습니다.
- **패킷 필터링 및 검색**: 디스플레이 필터와 캡처 필터를 사용하여, 필요한 패킷만 추출하거나 특정 조건에 맞는 패킷을 검색할 수 있습니다.
- **패킷 내 데이터 재구성**: TCP 스트림이나 HTTP 세션을 재구성하여, 트래픽의 전체 흐름을 파악하고 파일 다운로드, 텍스트 내용 등을 복원할 수 있습니다.

# Wireshark 기본 사용 방법

Wireshark는 GUI 기반의 도구이므로, 다음은 Wireshark를 사용하는 기본적인 절차를 설명합니다.

터미널에 `wireshark`를 입력하여 Wireshark를 실행합니다.

```bash
wireshark
```

## 1. 네트워크 인터페이스 선택

Wireshark를 실행하면, 시스템의 모든 **네트워크 인터페이스 목록**이 표시됩니다.

분석하고자 하는 네트워크 인터페이스(예: `eth0`, `wlan0`, `lo`)를 선택합니다.

선택한 인터페이스에서 발생하는 모든 **트래픽을 실시간으로 캡처**할 수 있습니다.

<p id="img_center">
  <img 
        src="../../assets/images/Security/10-01.jpg"
        alt="image"
        title="image"
  >
</p>

## 2. 패킷 캡처 시작 및 정지

<b>캡처 시작</b>

- 상단 메뉴에서 `Start Capture` 버튼을 클릭하여 패킷 캡처를 시작합니다.
- 실시간으로 해당 네트워크 인터페이스에서 발생하는 모든 패킷이 화면에 표시됩니다.

<b>캡처 정지</b>

캡처를 종료하려면 `Stop Capture` 버튼을 클릭합니다.
캡처된 패킷은 Wireshark에 정지된 상태로 표시되며, 이후 분석을 진행할 수 있습니다.

<p id="img_center">
  <img 
        src="../../assets/images/Security/10-02.jpg"
        alt="image"
        title="image"
  >
</p>

## 3. 패킷 필터링 및 검색

Wireshark는 매우 강력한 필터링 기능을 제공하여, **특정 패킷만을 추출하거나 분석**할 수 있습니다.

### 디스플레이 필터

**화면에 표시할 패킷을 필터링**합니다.

예를 들어, 특정 IP 주소나 특정 프로토콜을 기준으로 패킷을 필터링할 수 있습니다.

```bash
ip.src == 192.168.0.1 && tcp.port == 80
```

예시: 위의 필터는 **출발지 IP 주소**가 `192.168.0.1`이고, **TCP 포트**가 `80`(**HTTP**)인 패킷만 화면에 표시합니다.

### 캡처 필터

실시간 캡처 시, **특정 조건에 맞는 패킷만을 캡처**하도록 설정합니다.

예를 들어, ARP 프로토콜만 캡처하거나, 특정 IP 주소로 향하는 트래픽만 캡처하도록 제한할 수 있습니다.

```bash
arp
```

예시: 위의 필터는 ARP 프로토콜의 패킷만 캡처하도록 설정합니다.

## 4. 패킷 상세 정보 분석

캡처된 패킷을 선택하면, 해당 패킷의 상세 정보가 하단에 표시됩니다.

**헤더 정보**: 각 패킷의 이더넷, IP, TCP/UDP, HTTP 등의 프로토콜 헤더 정보를 확인할 수 있습니다.

**데이터 내용**: 패킷에 포함된 데이터의 원본 내용을 확인하고, 텍스트나 16진수(HEX) 형식으로 출력할 수 있습니다.

## 5. 패킷 흐름 재구성

Wireshark는 TCP 스트림이나 HTTP 세션을 재구성하여, 전체 트래픽 흐름을 파악할 수 있습니다.

**TCP 스트림 재구성**: 특정 TCP 스트림을 선택하고 `Follow TCP Stream`을 클릭하면, **클라이언트와 서버 간의 전체 대화 내용을 재구성**하여 하나의 세션으로 표시합니다.

**HTTP 세션 분석**: HTTP 요청 및 응답을 재구성하여, 웹 페이지 내용이나 파일 다운로드 등의 트래픽을 분석하고 전체 응답 내용을 확인할 수 있습니다.

## 6. 패킷 저장 및 로드

Wireshark는 캡처된 패킷을 **PCAP 파일 형식**으로 저장하고, 나중에 이를 불러와 분석할 수 있습니다.

**패킷 저장**: 캡처된 패킷을 파일로 저장하여, 나중에 분석하거나 다른 툴에서 사용할 수 있습니다.

**패킷 불러오기**: 기존에 저장된 PCAP 파일을 불러와, 동일한 환경에서 다시 분석할 수 있습니다.

# Wireshark 주요 활용 사례

## 1. 네트워크 문제 해결

네트워크 상에서 발생하는 지연, 패킷 손실, 접속 문제 등을 분석하고, 원인을 파악하여 문제를 해결합니다.

예를 들어, 특정 서버와의 연결이 자주 끊어진다면, 패킷을 분석하여 TCP 연결 설정 및 세션 관리에 문제가 있는지 확인할 수 있습니다.

## 2. 보안 점검 및 침입 분석

Wireshark는 네트워크 트래픽을 분석하여 의심스러운 활동이나 공격 시도를 탐지하고, 침입 분석을 수행할 수 있습니다.

예를 들어, DNS 트래픽 분석을 통해 DNS 터널링 공격을 탐지하거나, ARP 트래픽 분석을 통해 ARP 스푸핑 공격을 확인할 수 있습니다.

## 3. 네트워크 프로토콜 연구

다양한 네트워크 프로토콜의 패킷을 분석하여, 프로토콜의 동작 방식 및 상호 작용을 연구할 수 있습니다.

프로토콜 간의 호환성 문제나 특정 프로토콜의 비정상 동작을 파악하는 데 유용합니다.

## 4. HTTP/HTTPS 트래픽 분석

HTTP 요청 및 응답을 분석하여, 웹 애플리케이션의 요청 흐름과 데이터 전송을 이해할 수 있습니다.

HTTPS 트래픽의 경우, SSL/TLS 복호화 설정을 통해, 암호화된 트래픽을 분석할 수도 있습니다.

## 5. 악성 코드 및 의심스러운 트래픽 분석

네트워크를 통해 의심스러운 트래픽이 발생할 때, 이를 분석하여 악성 코드나 정보 유출 여부를 확인할 수 있습니다.

예를 들어, 특정 서버로의 비정상적인 트래픽 전송을 탐지하여, 데이터 유출이나 봇넷 활동을 확인할 수 있습니다.

# Wireshark 명령어 (CLI 기반)

Wireshark는 GUI를 기본으로 제공하지만, CLI 기반 도구로도 사용할 수 있는 `tshark`라는 명령어를 제공합니다.

`tshark` 명령어: **Wireshark의 CLI 버전**으로, 실시간 패킷 캡처 및 분석을 수행할 수 있습니다.

```bash
tshark -i eth0 -f "tcp port 80" -w http_traffic.pcap
```

예시:
- `-i eth0`: eth0 인터페이스에서 패킷을 캡처합니다.
- `-f "tcp port 80"`: TCP 포트 80(HTTP) 트래픽만 캡처합니다.
- `-w http_traffic.pcap`: 캡처된 패킷을 `http_traffic.pcap` 파일로 저장합니다.

## tshark의 주요 기능

1. **패킷 캡처 및 필터링**: 특정 조건에 맞는 패킷을 실시간으로 캡처하고, 디스플레이 및 캡처 필터를 사용할 수 있습니다.

2. **파일 저장 및 분석**: 캡처된 데이터를 파일로 저장하고, 이후 분석에 사용할 수 있습니다.

3. **정규 표현식 지원**: 다양한 정규 표현식을 통해 패킷을 검색하거나 필터링할 수 있습니다.