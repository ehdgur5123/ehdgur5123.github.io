---
layout: single
title: "5) nmap 명령어"
categories: Security
tag: [Security]
permalink : /posts/Security-05/
toc: true
classes: custom-style
author_profile: false
sidebar:
  nav: "Security"
---

<hr>

# nmap 명령어

`nmap`(Network Mapper)은 네트워크 스캐닝 및 보안 감사 도구로, 네트워크의 포트 스캐닝, 호스트 발견, 서비스 및 운영체제(OS) 감지를 수행할 수 있습니다. 오픈 소스로 제공되며, 네트워크 관리 및 보안 분석을 위한 강력한 기능을 제공합니다. `nmap`은 네트워크의 장비 및 서비스 구성을 확인하고, **취약한 서비스나 포트를 탐지**하여 **보안 문제를 진단**하는 데 유용합니다.

`nmap`에 대한 더욱 자세한 정보를 알고 싶으면 다음을 참조하세요. (👉 [nmap.org](https://nmap.org/))

## 1. nmap 명령어 기본 구문

```bash
nmap [옵션] [대상 IP 주소 또는 호스트 이름]
```

## 2. 주요 기능 및 특징

1. **포트 스캔**: 대상 시스템의 열려 있는 포트(예: 80, 443)를 확인하여, 해당 포트에서 어떤 서비스가 실행 중인지 확인할 수 있습니다.
2. **호스트 탐색**: 네트워크 상의 활성화된 호스트(온라인 상태)를 확인하여 장비 목록을 생성할 수 있습니다.
3. **서비스 및 버전 탐지**: 실행 중인 서비스의 종류 및 버전을 탐지하여, 어떤 소프트웨어가 동작 중인지 확인할 수 있습니다.
4. **운영체제(OS) 탐지**: 대상 시스템의 운영체제 유형 및 버전을 확인하여, 리눅스, 윈도우 등 OS 정보를 수집합니다.
5. **방화벽 및 IDS/IPS 우회**: 방화벽이나 침입 탐지 시스템(IDS)을 우회하여 보안 장비 뒤의 네트워크 정보를 탐지할 수 있습니다.
6. **취약점 탐지**: 추가 스크립트(-sC)를 사용하여 취약점이나 비정상적인 서비스 설정을 탐지할 수 있습니다.

## 3. 주요 옵션 및 조건

### 대상 시스템의 기본 포트 스캔

기본적으로 `nmap` 명령어는 대상 시스템의 상위 <b>1,000개</b> 포트를 스캔합니다. **열려 있는 포트와 실행 중인 서비스를 탐지**하여 간단한 네트워크 상태를 확인할 수 있습니다.

```bash
nmap 192.168.111.129   

>>>
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-05 21:03 EDT
Nmap scan report for 192.168.111.129
Host is up (0.00085s latency).
Not shown: 991 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
143/tcp  open  imap
443/tcp  open  https
445/tcp  open  microsoft-ds
5001/tcp open  commplex-link
8080/tcp open  http-proxy
8081/tcp open  blackice-icecap
```

예시: `192.168.111.129`의 상위 1,000개 포트를 스캔하고, 열려 있는 포트와 실행 중인 서비스를 출력합니다.

### 특정 포트만 스캔하기(-p)

`-p` 옵션을 사용하여 **특정 포트 또는 포트 범위를 지정**할 수 있습니다. 기본 포트(상위 1,000개) 외에, 특정 포트를 지정하여 탐색을 수행할 때 유용합니다.

```bash
nmap -p 80,443 example.com
```

예시1: `example.com`의 <b>80번 포트(HTTP)<b>와 <b>443번 포트(HTTPS)<b>만을 스캔합니다.

```bash
nmap -p 1-65535 example.com
```

예시2: `example.com`의 <b>모든 포트(1번부터 65535번까지)</b>를 스캔합니다.

### 서비스 및 버전 정보 탐지(-sV)

`-sV` 옵션을 사용하면, `nmap`은 열려 있는 포트의 **서비스 종류 및 버전 정보를 탐지**합니다. 이를 통해 대상 시스템에서 실행 중인 특정 애플리케이션의 버전을 확인할 수 있습니다.

```bash
nmap -sV example.com
```

예시: `example.com`의 열려 있는 포트에서 실행 중인 서비스 및 버전 정보를 탐지합니다.

### 운영체제(OS) 탐지(-O)

`-O` 옵션은 대상 시스템의 **운영체제(OS)**를 탐지합니다. TCP/IP 스택을 분석하여, 리눅스, 윈도우 등의 운영체제와 버전을 식별할 수 있습니다.

```bash
nmap -O example.com
```

예시: `example.com`의 운영체제 정보를 탐지하여, 리눅스, 윈도우 등의 OS 정보를 출력합니다.

### 호스트 탐지(-sn)

`-sn` 옵션을 사용하면, `nmap`이 포트 스캔을 수행하지 않고 대상 네트워크에서 **활성화된 호스트(온라인 상태인 시스템)**만 탐색합니다. 이를 통해 네트워크 상의 장비 목록을 쉽게 생성할 수 있습니다.

```bash
nmap -sn 192.168.1.0/24
```

예시: `192.168.1.0/24` 네트워크 범위의 활성화된 호스트를 탐지하여 목록을 출력합니다.

<small>`/24`는 서브넷 마스크(255.255.255.0)로, 네트워크 부분이 24 비트(`192.168.1`) 호스트 부분이 마지막 8비트를 나타냄. 즉, `192.168.1.0`에서 `192.168.1.255`까지의 열려있는 호스트 부분만을 탐색</small>

### 빠른 스캔(-T)

`-T` 옵션은 `nmap`의 스캔 속도(템포)를 조정하여, 빠른 스캔 또는 정밀한 스캔을 수행할 수 있습니다. 기본적으로 **5가지 레벨**이 있으며, T0(가장 느림)부터 T5(가장 빠름)까지 설정할 수 있습니다.

`-T0` ~ `-T2`는 느린 스캔으로, 네트워크에 부하를 덜 주면서 정밀한 분석을 합니다.

`-T3`는 기본 스캔 속도입니다.

`-T4` ~ `T5`는 빠른 스캔으로, 빠르게 결과를 얻을 수 있으나 정확도가 떨어질 수 있습니다.

```bash
nmap -T4 example.com
```

예시: `example.com`을 <b>빠른 속도(T4)</b>로 스캔합니다.

### 기본 스크립트를 사용한 취약점 분석 (-sC)

`-sC` 옵션은 `nmap`이 제공하는 기본 **NSE 스크립트(Nmap Scripting Engine)**의 **default 카테고리**를 사용하여 취약점 분석을 수행합니다. 이 스크립트는 일반적인 취약점 및 보안 점검을 위해 *미리 정의된 스크립트를 사용하여 대상 시스템을 분석*합니다.

<small>NSE 스크립트는 다양한 종류가 있으며, `/usr/share/nmap/scripts/` 경로에서 볼 수 있음</small>

```bash
nmap -sC example.com
```

예시: `example.com`에 대해 기본 보안 스크립트를 사용하여 취약점 점검을 수행합니다.

### 탐색 결과를 파일로 저장 (-o)

`-o` 옵션을 사용하면, `nmap`의 탐색 결과를 파일로 저장할 수 있습니다. 파일 형식을 텍스트 파일(`-oN`), XML 파일(`-oX`), 그렙 형식(`-oG`) 등으로 지정할 수 있습니다.

```bash
nmap -oN results.txt example.com
```

예시: `example.com`의 스캔 결과를 `results.txt` 텍스트 파일(N)로 저장합니다.

## NSE 스크립트(Nmap Scripting Engine)

NSE 스크립트는 `nmap`이 제공하는 **루아(Lua) 스크립트 기반**의 자동화 도구로, 사용자가 네트워크 분석 작업을 자동화하고 복잡한 작업을 수행할 수 있도록 돕습니다.

일반적으로 `nmap`이 설치된 시스템에서는 다음 경로에 스크립트들이 위치합니다

```bash
/usr/share/nmap/scripts/
```

### NSE 스크립트 카테고리

`nmap` NSE 스크립트는 목적과 기능에 따라 여러 카테고리로 나뉘어 있습니다. 아래는 주요 카테고리와 설명입니다.

|  카테고리 |                              설명                             |                                                   비고                                                  |
|:---------:|:-------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------:|
|    auth   |                       인증 관련 스크립트                      |           SSH, FTP, HTTP, RDP와 같은 서비스에 대한 인증 우회 또는 인증 정보 확인을 수행합니다.          |
| broadcast |                   브로드캐스트 기반 스크립트                  |    로컬 네트워크의 장비를 탐지하거나, 특정 서비스(예: SMB, UPnP)에 대한 브로드캐스트 요청을 보냅니다.   |
|   brute   |             무차별 대입 공격(Brute-force) 스크립트            |       FTP, SSH, HTTP 등 다양한 프로토콜에 대해 무차별 대입 공격을 시도하여 인증 정보를 탐지합니다.      |
|  default  |                         기본 스크립트                         |    nmap -sC 옵션으로 실행할 수 있으며, 일반적인 정보 수집과 보안 점검을 수행하는 스크립트 모음입니다.   |
| discovery |                네트워크 및 서비스 탐지 스크립트               |                  네트워크 상의 서비스, 장비 등을 탐지하고, 추가적인 정보를 수집합니다.                  |
|    dos    |          서비스 거부 공격(Denial of Service) 스크립트         |     특정 서비스에 대해 서비스 거부 공격(DoS)을 시도하여, 해당 서비스의 취약점을 탐지할 수 있습니다.     |
|  exploit  |                      취약점 공격 스크립트                     |                     대상 서비스의 알려진 취약점을 악용하여 취약한 상태를 확인합니다.                    |
|  external |                외부 서비스와 연동되는 스크립트                |          예를 들어, Whois 서버나 Shodan과 같은 외부 데이터베이스와 연동하여 정보를 수집합니다.          |
|   fuzzer  |                     입력 값 퍼징 스크립트                     | 다양한 입력 값을 통해 서비스를 테스트하고, 비정상적인 동작을 유발할 수 있는 퍼징(Fuzzing)을 수행합니다. |
| intrusive | 네트워크 또는 서비스에 영향을 줄 수 있는 공격성 높은 스크립트 |            서비스의 오작동을 유발할 수 있으므로, 사전 허가 없이 사용하지 않는 것이 좋습니다.            |
|  malware  |               악성 코드 및 백도어 탐지 스크립트               |                         시스템에 알려진 악성 코드나 백도어가 있는지 검사합니다.                         |
|    safe   |                안전하게 실행할 수 있는 스크립트               |                      네트워크나 서비스에 영향을 주지 않는 정보 수집 스크립트입니다.                     |
|  version  |                   서비스 버전 탐지 스크립트                   |                     특정 포트의 서비스 버전을 식별하고, 버전 관련 정보를 수집합니다.                    |
|    vuln   |                      취약점 탐지 스크립트                     |             알려진 취약점(CVE)이나 보안 이슈를 검사하여, 서비스의 취약한 상태를 탐지합니다.             |


### NSE 스크립트 사용방법

#### 모든 스크립트 사용

`-sC` 옵션은 기본 스크립트만 실행하지만, **모든 스크립트를 사용**하려면 다음과 같이 `--script` 옵션을 활용해야 합니다

```bash
nmap --script "all" example.com
```

예시: `nmap`이 제공하는 모든 스크립트(`auth`, `vuln`, `exploit`, `brute` 등 모든 카테고리 포함)를 사용하여 스캔을 수행합니다.

이 경우, 모든 스크립트가 실행되므로 스캔 시간이 매우 길어질 수 있으며, 네트워크나 서비스에 영향을 줄 수 있는 스크립트도 포함될 수 있습니다.

#### 카테고리별 스크립트 사용

특정 카테고리만 선택하여 스캔하고 싶다면, **카테고리 이름을 지정**하면 됩니다

```bash
nmap --script "vuln" example.com
```

예시1: 취약점 스크립트인 `vuln` 카테고리만을 사용하여 스캔합니다.

```bash
nmap --script "default or safe" example.com
```

예시2: `default`와 `safe` 카테고리에 속한 스크립트를 사용하여 스캔합니다.

#### 특정 스크립트 사용

`/usr/share/nmap/scripts/` 경로에 있는 특정 스크립트만을 사용하여 스캔이 가능합니다.

```bash
nmap --script http-vuln-cve2015-1635 example.com
```

예시: `http-vuln-cve2015-1635` 스크립트만을 사용하여 `example.com`을 스캔합니다.

<small>`http-vuln-cve2015-1635`는 `/usr/share/nmap/scripts/` 경로 내에 `http-vuln-cve2015-1635.nse` 파일로 존재합니다.</small>