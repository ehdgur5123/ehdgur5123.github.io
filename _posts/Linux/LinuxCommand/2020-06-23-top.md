---
layout: single
title: "top 명령어"
categories: Linux
tag: [Linux, top]
permalink : /posts/LinuxCommand-top/
classes : custom-style
toc: true
author_profile: false
sidebar:
  nav: "Linux"
---

<hr>

# top 명령어

`top` 명령어는 "Table of Processes"의 약자로, Linux 및 Unix 계열 운영 체제에서 **실시간으로 시스템의 프로세스와 리소스 사용 현황**을 보여주는 도구입니다. 주로 CPU 사용량, 메모리 사용량, 실행 중인 프로세스의 정보를 실시간으로 모니터링하는 데 사용됩니다.

## top 명령어 기본 구문

```bash
top [옵션]
```

`top` 명령어는 별도의 옵션 없이 실행하면 시스템 리소스와 관련된 실시간 정보를 **터미널 화면에 동적으로 업데이트**하며 표시합니다.

## 주요 옵션 및 조건

### 실행 중인 프로세스 보기 (-u)

`-u`: 특정 사용자의 프로세스만 보려면 사용자 이름을 지정할 수 있습니다. 이 옵션을 사용하면 **특정 사용자가 실행한 프로세스만 표시**됩니다.

```bash
top -u user1
```

예시: `user1` 사용자의 프로세스만 실시간으로 모니터링합니다.

### 반복 횟수 지정(-n)

`-n`: **지정된 횟수만큼만 화면을 업데이트**한 후, 자동으로 종료합니다. 기본적으로 `top`은 계속해서 업데이트되지만, 이 옵션을 사용하면 지정한 횟수만 실행됩니다.

```bash
top -n 5
```

예시: 화면을 5번 업데이트한 후 자동으로 종료합니다.

### 특정 PID를 지정하여 모니터링(-p)

`-p`: **특정 프로세스(PID)만을 모니터링**합니다. 하나의 프로세스 ID 또는 여러 프로세스 ID를 지정할 수 있습니다.

```bash
top -p <PID>
```

예시: PID가 `<PID>`인 프로세스만 모니터링합니다.

### 모든 CPU 정보 표시(1)

`1`: **모든 CPU의 각 코어 사용량을 별도로 표시**합니다. 기본적으로는 전체 CPU 사용량만 보이지만, 이 옵션을 사용하면 각 코어별 사용률을 확인할 수 있습니다.

```bash
top 1
```

예시: 모든 CPU 코어의 사용량을 각각 보여줍니다.

### 메모리 사용량 기준으로 정렬(Shift + M)

`Shift + M`: 실행 중인 프로세스를 **메모리 사용량 기준으로 정렬**합니다. 어떤 프로세스가 많은 메모리를 사용하는지 확인할 수 있습니다.(터미널의 `%MEM` 순으로 정렬)

```bash
top  # top 실행 중에 Shift + M
```

예시: 메모리 사용량 기준으로 프로세스를 정렬하여 실시간으로 보여줍니다.

### CPU 사용량 기준으로 정렬(Shift + P)

`Shift + P`: 프로세스를 **CPU 사용량 기준으로 정렬**합니다. 기본적으로 CPU 사용량이 높은 프로세스가 먼저 표시됩니다.(터미널의 `%CPU` 순으로 정렬)

```bash
top  # top 실행 중에 Shift + P
```

예시: CPU 사용량이 많은 프로세스를 먼저 볼 수 있습니다.

## 주요 화면 정보 설명

top 명령어를 실행하면, 화면 상단과 하단에 시스템 관련 정보가 표시됩니다. 각 항목이 의미하는 바를 설명하겠습니다.

```python
top - 17:34:48 up 3 days,  5:13,  1 user,  load average: 0.64, 0.81, 0.76
작  업: 259 총계,   1 실행, 258 대기,   0 멈춤,   0 좀비
%Cpu:  2.8 us,  1.1 sy,  0.0 ni, 96.0 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
MiB 메모리 :   7855.7 total,    959.4 free,   3036.6 used,   3859.6 buff/cache
MiB 스  왑:   2048.0 total,   2048.0 free,      0.0 used.   3940.0 avail 메모리

PID USER  PR  NI     VIRT    RES    SHR  S  %CPU  %MEM    TIME+    COMMAND
  1 root  26   0   168008  13392   8352  S   0.0   0.2  0:06.04    systemd
```

### 상단의 요약 정보

1. <b>uptime</b>: 시스템이 실행된 시간(가동 시간)과 로드 평균(로드 평균은 1분, 5분, 15분간 CPU의 부하 상태를 나타냅니다).

2. <b>Tasks</b>: 현재 시스템에서 실행 중인 프로세스 정보입니다.

    - `total`: 전체 프로세스 수
    - `running`: 실행 중인 프로세스 수
    - `sleeping`: 대기 중인 프로세스 수
    - `stopped`: 중지된 프로세스 수
    - `zombie`: 좀비 프로세스 수 (종료된 상태에서 부모 프로세스에 의해 수거되지 않은 프로세스)

3. <b>CPU 사용량 정보</b>: CPU 자원의 사용 상태를 나타냅니다.

    - `us`: 사용자 공간에서 사용하는 CPU 비율
    - `sy`: 커널 공간에서 사용하는 CPU 비율
    - `ni`: 낮은 우선순위의 사용자 프로세스가 CPU를 사용한 시간 비율
    - `id`: 유휴 상태의 CPU 비율
    - `wa`: I/O 대기 중인 CPU 비율
    - `hi`: 하드웨어 인터럽트 처리에 사용된 CPU 시간 비율
    - `si`: 소프트웨어 인터럽트 처리에 사용된 CPU 시간 비율
    - `st`: 가상 CPU의 대기 시간(하이퍼바이저에서 빼앗긴 시간)

4. 메모리 사용량:

    - `Mem`: 물리적 메모리 사용량
    - `Swap`: 스왑 메모리 사용량

### 하단의 프로세스 목록

1. `PID`: 프로세스 ID
2. `USER`: 프로세스를 실행한 사용자
3. `PR`(Priority): 프로세스의 우선순위. 숫자가 작을수록 우선순위가 높음.
4. `NI`(Nice value): 프로세스의 nice 값으로, 우선순위에 영향을 미침. -20에서 19까지.
5. `VIRT`(Virtual memory size): 프로세스가 사용하는 가상 메모리의 총 크기.
6. `RES`(Resident memory size): 프로세스가 실제로 사용하는 물리적 메모리 크기.
7. `SHR`(Shared memory size): 프로세스가 다른 프로세스와 공유하는 메모리의 크기.
8. `S`(State): 프로세스의 상태. 실행 중, 대기 중, 중지, 좀비 상태 등을 나타냄.
9. `%CPU`: 프로세스가 사용하는 CPU 비율
10. `%MEM`: 프로세스가 사용하는 메모리 비율
11. `TIME+`: 프로세스가 실행된 총 시간
12. `COMMAND`: 실행 중인 명령어(프로세스 이름)

#### PR (Priority - 우선순위)

- `PR`은 프로세스의 우선순위를 나타냅니다.

- 리눅스 커널이 어떤 프로세스를 먼저 처리할지를 결정하는 기준입니다.

- **숫자가 낮을수록 프로세스의 우선순위가 높습니다.** 즉, 낮은 PR 값을 가진 프로세스는 CPU 자원을 우선적으로 할당받습니다.

- 범위:
    - 일반 프로세스의 우선순위는 0~139 사이로 설정됩니다.
    - 0~99는 실시간 우선순위이며, 이 값은 관리자가 지정할 수 없습니다.
    - 100~139는 일반 우선순위입니다.

#### NI (Nice value - 니스 값)

- `NI`는 프로세스의 nice 값으로, **우선순위(PR)**에 영향을 미칩니다.

- nice 값은 `-20`에서 `19` 사이의 범위를 가지며, 값이 작을수록 우선순위가 높아집니다.

- nice 값은 프로세스가 얼마나 CPU 자원을 양보할 것인지를 결정합니다. 즉, 값이 클수록 다른 프로세스에 더 많은 CPU를 양보하게 됩니다.

- 범위:
    - `-20`: 가장 높은 우선순위
    - `19`: 가장 낮은 우선순위

- 프로세스의 **PR(우선순위)**는 NI 값에 따라 변경됩니다. 기본 nice 값은 `0`입니다.

#### VIRT (Virtual memory size - 가상 메모리 크기)

- `VIRT`는 프로세스가 사용하는 가상 메모리의 총 크기를 나타냅니다.

- 이 값에는 프로세스가 사용하는 실제 메모리(RES)뿐만 아니라, 스왑 메모리(SWAP), 공유 메모리, 맵핑된 파일 등도 포함됩니다.

- 즉, 프로세스가 할당받은 메모리 전체를 나타냅니다.

#### RES (Resident memory size - 실제 메모리 사용량)

- `RES`는 프로세스가 실제로 사용하는 물리적 메모리(RAM)의 크기를 나타냅니다.

- 가상 메모리 중에서 실제 주 메모리(RAM)에 상주하는 메모리 양을 보여줍니다.

- 이는 실제로 현재 시스템에서 프로세스가 사용 중인 메모리 양을 나타내기 때문에 메모리 사용량을 모니터링할 때 중요한 정보입니다.

#### SHR (Shared memory - 공유 메모리)

- `SHR`은 공유 메모리의 크기를 나타냅니다.

- 프로세스가 다른 프로세스와 공유하는 메모리 영역으로, 라이브러리나 공유 메모리로 사용되는 부분입니다.

- 여러 프로세스가 같은 라이브러리를 사용할 때 메모리 절약을 위해 이 메모리 영역을 공유하게 됩니다.

- 이 값이 클수록 프로세스가 사용하는 공유 메모리의 비율이 높음을 의미합니다.

#### S (State - 상태)

- `S`는 프로세스의 현재 상태를 나타냅니다.

- 프로세스가 현재 실행 중인지, 대기 중인지, 중단되었는지를 알려줍니다.

- 상태 값:

    - `R`: 실행 중 (Running)
    - `S`: 대기 상태 (Sleeping)
    - `D`: 중단되지 않는 대기 상태 (Uninterruptible Sleep, 보통 I/O 작업 중)
    - `T`: 중지됨 (Stopped)
    - `Z`: 좀비 상태 (Zombie)